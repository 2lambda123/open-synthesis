{% extends 'boards/base.html' %}

{% block title %}Evidence Detail | Open Synthesis{% endblock %}

{% load board_extras %}

{% block content %}

    <h1>
        Evidence for {{ evidence.board.board_title }}
    </h1>

    <div>
        Added by <a href="{% url 'profile' evidence.creator.id %}">{{ evidence.creator.username }}</a>
        on {{ evidence.submit_date }}
        {% if evidence.event_date %}
            Event occurred on {{ evidence.event_date }}.
        {%  endif %}
    </div>
    <div class="well">{{ evidence.evidence_desc }}</div>

    <div>
        <a class="btn btn-primary" href="{% url 'openach:add_source' evidence.id %}?kind=corroborate">Add Corroborating Source</a>
        <a class="btn btn-warning" href="{% url 'openach:add_source' evidence.id %}?kind=conflicting">Add Conflicting Source</a>
        <a class="btn btn-default" href="{% url 'openach:detail' evidence.board_id %}">Return to Board</a>
    </div>

    <table class="table table-hover">
        <thead>
        <tr>
            <th>Source Date</th>
            <th>Quality Tags</th>
            <th>Source URL</th>
            <th>Submission</th>
            <th>Add Quality Tag</th>
        </tr>
        </thead>
        <tbody>
        {% for source in sources %}
            <tr class="{% if not source.corroborating %}src-conflicting{% endif %}">
                <td>{{ source.source_date }}</td>
                <td>
                    {% for tag in available_tags %}
                        {% get_source_tags source_tags source.id tag.id as tag_count %}
                        {% if tag_count %}
                            <span class="source-tag">{{ tag.tag_name }} x {{ tag_count|length }}</span>
                        {% endif %}
                    {% endfor %}
                </td>
                <td>
                    <a href="{{ source.source_url }}" target="_blank">{{ source.source_url }}</a>
                </td>
                <td>
                    Submitted on {{ source.submit_date }} by
                    <a href="{% url 'profile' source.uploader.id %}">{{ source.uploader.username }}</a>
                </td>
                <td>
                    <form action="{% url 'openach:tag_source' evidence.id source.id %}" method="post">
                        {% csrf_token %}
                        {% for tag in available_tags %}
                            <input type="submit" class="btn btn-default btn-xs" name="tag" value="{{ tag.tag_name }}"/>
                        {% endfor %}
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% endblock %}